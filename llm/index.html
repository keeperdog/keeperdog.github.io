<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LLM AI ç›¸å…³ä¾‹å­ demo | keeperdog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="keeperdog">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.6e54da3e.css" as="style"><link rel="preload" href="/assets/js/app.43ae17cf.js" as="script"><link rel="preload" href="/assets/js/2.e9459d84.js" as="script"><link rel="preload" href="/assets/js/1.6a359339.js" as="script"><link rel="preload" href="/assets/js/13.85cf1ae9.js" as="script"><link rel="prefetch" href="/assets/js/10.7772999a.js"><link rel="prefetch" href="/assets/js/11.fbb5f897.js"><link rel="prefetch" href="/assets/js/12.7a864a4a.js"><link rel="prefetch" href="/assets/js/14.356766f3.js"><link rel="prefetch" href="/assets/js/15.391b4260.js"><link rel="prefetch" href="/assets/js/16.1518614c.js"><link rel="prefetch" href="/assets/js/17.ce109c8b.js"><link rel="prefetch" href="/assets/js/18.4f3cbe51.js"><link rel="prefetch" href="/assets/js/19.dae9c7c1.js"><link rel="prefetch" href="/assets/js/20.d3a51191.js"><link rel="prefetch" href="/assets/js/21.64a0c85e.js"><link rel="prefetch" href="/assets/js/22.aa8d2bb9.js"><link rel="prefetch" href="/assets/js/23.b30a8c26.js"><link rel="prefetch" href="/assets/js/24.a2dc6bd6.js"><link rel="prefetch" href="/assets/js/25.f3f0ccb5.js"><link rel="prefetch" href="/assets/js/26.1c73e93f.js"><link rel="prefetch" href="/assets/js/27.e49a5fb6.js"><link rel="prefetch" href="/assets/js/28.f00b5ac0.js"><link rel="prefetch" href="/assets/js/29.950151ac.js"><link rel="prefetch" href="/assets/js/3.58fac34f.js"><link rel="prefetch" href="/assets/js/30.71b081e2.js"><link rel="prefetch" href="/assets/js/31.f28cdf7f.js"><link rel="prefetch" href="/assets/js/32.45506f8a.js"><link rel="prefetch" href="/assets/js/33.78dc621b.js"><link rel="prefetch" href="/assets/js/34.59cccec0.js"><link rel="prefetch" href="/assets/js/35.72006333.js"><link rel="prefetch" href="/assets/js/36.12376a1d.js"><link rel="prefetch" href="/assets/js/37.37cff265.js"><link rel="prefetch" href="/assets/js/38.b6b40b99.js"><link rel="prefetch" href="/assets/js/39.0ce7d52f.js"><link rel="prefetch" href="/assets/js/4.34a0f087.js"><link rel="prefetch" href="/assets/js/40.ed84ab6d.js"><link rel="prefetch" href="/assets/js/41.d72774f1.js"><link rel="prefetch" href="/assets/js/42.f535f8c1.js"><link rel="prefetch" href="/assets/js/43.39cf8017.js"><link rel="prefetch" href="/assets/js/5.d2a097f1.js"><link rel="prefetch" href="/assets/js/6.3bed0312.js"><link rel="prefetch" href="/assets/js/7.b27555b5.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.56c672f1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6e54da3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/2.jpeg" alt="keeperdog" class="logo"> <span class="site-name can-hide">keeperdog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontend/" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/llm/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  LLM
</a></div><div class="nav-item"><a href="/resume/" class="nav-link">
  Resume
</a></div><div class="nav-item"><a href="/sharing/" class="nav-link">
  Sharing
</a></div><div class="nav-item"><a href="/speech/" class="nav-link">
  Speech
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontend/" class="nav-link">
  Frontend
</a></div><div class="nav-item"><a href="/llm/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  LLM
</a></div><div class="nav-item"><a href="/resume/" class="nav-link">
  Resume
</a></div><div class="nav-item"><a href="/sharing/" class="nav-link">
  Sharing
</a></div><div class="nav-item"><a href="/speech/" class="nav-link">
  Speech
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/llm/" aria-current="page" class="active sidebar-link">LLM AI ç›¸å…³ä¾‹å­ demo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/llm/#æç¤ºè¯å·¥ç¨‹" class="sidebar-link">æç¤ºè¯å·¥ç¨‹</a></li><li class="sidebar-sub-header"><a href="/llm/#ai-èŠå¤©æœºå™¨äºº" class="sidebar-link">AI èŠå¤©æœºå™¨äºº</a></li><li class="sidebar-sub-header"><a href="/llm/#rag-langchain-ç‰ˆæœ¬" class="sidebar-link">RAG-Langchain ç‰ˆæœ¬</a></li><li class="sidebar-sub-header"><a href="/llm/#rag-langchain-ä¸ªäººçŸ¥è¯†åº“åŠ©æ‰‹" class="sidebar-link">RAG-LangChain ä¸ªäººçŸ¥è¯†åº“åŠ©æ‰‹</a></li><li class="sidebar-sub-header"><a href="/llm/#rag-llamaindex-ç®€å•ç‰ˆæœ¬" class="sidebar-link">RAG-LlamaIndex ç®€å•ç‰ˆæœ¬</a></li><li class="sidebar-sub-header"><a href="/llm/#rag-llamaindex-é«˜çº§ç‰ˆæœ¬" class="sidebar-link">RAG-LlamaIndex é«˜çº§ç‰ˆæœ¬</a></li><li class="sidebar-sub-header"><a href="/llm/#tavily-web-search" class="sidebar-link">Tavily - Web Search</a></li><li class="sidebar-sub-header"><a href="/llm/#metagpt-æ™ºèƒ½ä½“ä¹‹ç®€å•åŠ å‡" class="sidebar-link">Metagpt - æ™ºèƒ½ä½“ä¹‹ç®€å•åŠ å‡</a></li><li class="sidebar-sub-header"><a href="/llm/#metagpt-æ™ºèƒ½ä½“ä¹‹æ„å›¾è¯†åˆ«" class="sidebar-link">Metagpt - æ™ºèƒ½ä½“ä¹‹æ„å›¾è¯†åˆ«</a></li><li class="sidebar-sub-header"><a href="/llm/#metagpt-æ™ºèƒ½ä½“ä¹‹åœºæ™¯ç»†åŒ–" class="sidebar-link">Metagpt - æ™ºèƒ½ä½“ä¹‹åœºæ™¯ç»†åŒ–</a></li><li class="sidebar-sub-header"><a href="/llm/#metagpt-æ™ºèƒ½ä½“ä¹‹å›ç­”åŠ©æ‰‹" class="sidebar-link">Metagpt - æ™ºèƒ½ä½“ä¹‹å›ç­”åŠ©æ‰‹</a></li><li class="sidebar-sub-header"><a href="/llm/#metagpt-æ™ºèƒ½ä½“ä¹‹æœç´¢åŠ©æ‰‹" class="sidebar-link">Metagpt - æ™ºèƒ½ä½“ä¹‹æœç´¢åŠ©æ‰‹</a></li><li class="sidebar-sub-header"><a href="/llm/#xtuner-finetuningæ¨¡å‹" class="sidebar-link">XTuner FineTuningæ¨¡å‹</a></li></ul></li><li><a href="/llm/llm_basic.html" class="sidebar-link">LLM AI åŸºç¡€</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä»€ä¹ˆæ˜¯rag" class="sidebar-link">ä»€ä¹ˆæ˜¯RAG</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#rag-æ ¸å¿ƒæ¨¡å—-ç»„ä»¶" class="sidebar-link">RAG æ ¸å¿ƒæ¨¡å—/ç»„ä»¶</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#rag-å·¥ä½œæµç¨‹" class="sidebar-link">RAG å·¥ä½œæµç¨‹</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#åœ¨-rag-ä¸­çš„-embedding-åµŒå…¥æ˜¯ä»€ä¹ˆ" class="sidebar-link">åœ¨ RAG ä¸­çš„ Embedding åµŒå…¥æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#rag-æŠ€æœ¯é¢ä¸´ç€å‡ ä¸ªå…³é”®æ€§çš„æŠ€æœ¯æŒ‘æˆ˜" class="sidebar-link">RAG æŠ€æœ¯é¢ä¸´ç€å‡ ä¸ªå…³é”®æ€§çš„æŠ€æœ¯æŒ‘æˆ˜</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#å¦‚ä½•è¯„ä»·ä¸€ä¸ªrag-çŸ¥è¯†åº“-åšçš„å¥½ä¸å¥½" class="sidebar-link">å¦‚ä½•è¯„ä»·ä¸€ä¸ªRagï¼ˆçŸ¥è¯†åº“ï¼‰åšçš„å¥½ä¸å¥½ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä»€ä¹ˆæ˜¯langchain" class="sidebar-link">ä»€ä¹ˆæ˜¯LangChain</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä»€ä¹ˆæ˜¯chainé“¾" class="sidebar-link">ä»€ä¹ˆæ˜¯Chainé“¾</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“" class="sidebar-link">ä»€ä¹ˆæ˜¯å‘é‡æ•°æ®åº“</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒåŸç†æ˜¯ä»€ä¹ˆ-æ ¸å¿ƒæŠ€æœ¯æ˜¯ä»€ä¹ˆ" class="sidebar-link">å‘é‡æ•°æ®åº“çš„æ ¸å¿ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿæ ¸å¿ƒæŠ€æœ¯æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä»€ä¹ˆæ˜¯mcp" class="sidebar-link">ä»€ä¹ˆæ˜¯MCPï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#mcp-çš„æ¦‚ç‡-ä¸ºä»€ä¹ˆ-mcp-æœ€è¿‘å¾ˆç«-å®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ" class="sidebar-link">MCP çš„æ¦‚ç‡ï¼Ÿä¸ºä»€ä¹ˆ MCP æœ€è¿‘å¾ˆç«ï¼Ÿå®ƒæœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹-context-prompt" class="sidebar-link">ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹ context promptï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#ä¸ºä»€ä¹ˆæœ‰ä¸Šä¸‹æ–‡å·¥ç¨‹-åŒºåˆ«-ä¸¾ä¸ªå…·ä½“çš„æ —å­ğŸŒ°" class="sidebar-link">ä¸ºä»€ä¹ˆæœ‰ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼ŸåŒºåˆ«ï¼Ÿä¸¾ä¸ªå…·ä½“çš„æ —å­ğŸŒ°</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#åœ¨é€‰ç”¨æ¨¡å‹æ—¶-å¦‚ä½•è€ƒé‡" class="sidebar-link">åœ¨é€‰ç”¨æ¨¡å‹æ—¶ï¼Œå¦‚ä½•è€ƒé‡</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#å¤§æ¨¡å‹è¾“å‡ºå‡ºç°é‡å¤å’Œå¹»è§‰å¦‚ä½•è§£å†³" class="sidebar-link">å¤§æ¨¡å‹è¾“å‡ºå‡ºç°é‡å¤å’Œå¹»è§‰å¦‚ä½•è§£å†³</a></li><li class="sidebar-sub-header"><a href="/llm/llm_basic.html#æ–¹æ¡ˆè®¾è®¡-æ™ºèƒ½ä½“è®¾è®¡" class="sidebar-link">æ–¹æ¡ˆè®¾è®¡ - æ™ºèƒ½ä½“è®¾è®¡</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="llm-ai-ç›¸å…³ä¾‹å­-demo"><a href="#llm-ai-ç›¸å…³ä¾‹å­-demo" class="header-anchor">#</a> LLM AI ç›¸å…³ä¾‹å­ demo</h1> <p>æ¯ä¸€ä¸ªä¾‹å­éƒ½æœ‰è‡ªå·±çš„å»ç»ƒä¹ è¿‡</p> <h2 id="æç¤ºè¯å·¥ç¨‹"><a href="#æç¤ºè¯å·¥ç¨‹" class="header-anchor">#</a> æç¤ºè¯å·¥ç¨‹</h2> <p>è¿™æ˜¯ä¸€ä¸ªåŸºäº Gradio çš„ Web åº”ç”¨ï¼Œç»“åˆ æ™ºè°± AI GLM-4 æ¨¡å‹ï¼Œæä¾›å¤šä¸ªç¤¾äº¤åœºæ™¯çš„ AI å¯¹è¯æœåŠ¡ã€‚ç”¨æˆ·å¯é€‰æ‹©ä¸åŒåœºæ™¯ï¼ˆå¦‚â€œæ•¬é…’â€ã€â€œé€ç¤¼â€ç­‰ï¼‰ï¼Œè·å–ç³»ç»Ÿæç¤ºè¯ã€ç¤ºä¾‹å¯¹è¯ï¼Œå¹¶ä¸ AI å®æ—¶äº’åŠ¨ã€‚</p> <p>ä¼ é€é—¨ï¼š<a href="https://www.modelscope.cn/studios/deshengkong/prompt_engineering_demo_001" target="_blank" rel="noopener noreferrer">prompt_engineering_demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="/assets/img/2025-07-09-08-49-30.19ee1c6b.png" alt="snapshot"></p> <h2 id="ai-èŠå¤©æœºå™¨äºº"><a href="#ai-èŠå¤©æœºå™¨äºº" class="header-anchor">#</a> AI èŠå¤©æœºå™¨äºº</h2> <p>è¿™ä¸ª demo å®ç°äº†ä¸€ä¸ªåŸºäº <strong>Streamlit</strong> æ¡†æ¶çš„ AI èŠå¤©æœºå™¨äººåº”ç”¨</p> <p>ä¼ é€é—¨ï¼š<a href="https://www.modelscope.cn/studios/deshengkong/chatbox_demo_001" target="_blank" rel="noopener noreferrer">chatbox_demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="/assets/img/2025-07-09-08-52-42.de3e6352.png" alt="snapshot"></p> <ul><li>åˆå§‹åŒ–å¹¶ç»´æŠ¤èŠå¤©è®°å½• (<code>messages</code>)ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’ŒåŠ©æ‰‹çš„æ¶ˆæ¯ã€‚</li> <li>å½“ç”¨æˆ·æäº¤é—®é¢˜æ—¶ï¼Œå°†ç”¨æˆ·è¾“å…¥æ·»åŠ åˆ°ä¼šè¯å†å²ï¼Œå¹¶æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ä¸Šã€‚</li> <li>ä½¿ç”¨ <code>OpenAI</code> å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ¨¡å‹ï¼ˆå¦‚ Qwen2.5-7B-Instructï¼‰è¿›è¡Œæµå¼å“åº”ç”Ÿæˆã€‚</li> <li>å°†ç³»ç»Ÿæç¤ºï¼ˆsystem messageï¼‰ã€ç”¨æˆ·è¾“å…¥ï¼ˆuser queryï¼‰å‘é€ç»™æ¨¡å‹ï¼Œå¹¶é€æ­¥æ¥æ”¶å’Œå±•ç¤º AI çš„å›å¤ã€‚</li> <li>ä½¿ç”¨ <code>Streamlit</code> æ„å»ºç®€æ´çš„ç½‘é¡µç•Œé¢ï¼Œæ”¯æŒ Markdown å’Œ HTML æ¸²æŸ“ï¼Œå±•ç¤º AI çš„æ€è€ƒè¿‡ç¨‹å’Œæœ€ç»ˆå›ç­”ã€‚</li></ul> <h2 id="rag-langchain-ç‰ˆæœ¬"><a href="#rag-langchain-ç‰ˆæœ¬" class="header-anchor">#</a> RAG-Langchain ç‰ˆæœ¬</h2> <p>è¿™ä¸ª demo æ˜¯å®ç°ä¸€ä¸ªåŸºäº<strong>Gradio</strong>çš„ RAG æ¨¡å‹ï¼ŒåŸºäº langchain å®ç°ã€‚</p> <ul><li>é€‰æ‹©Embeddingæ¨¡å‹ï¼ˆHuggingFaceæˆ–ZhipuAIï¼‰</li> <li>è®¾ç½®æ–‡æœ¬å—å¤§å°ï¼ˆå»ºè®®800-1000ï¼‰</li> <li>é…ç½®æ•°æ®æºï¼ˆæœ¬åœ°æ–‡ä»¶å¤¹æˆ–ç½‘é¡µURLï¼‰</li> <li>ç‚¹å‡»â€åˆå§‹åŒ–æ•°æ®åº“â€å¼€å§‹å¯¹è¯</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># åŸºæœ¬ç»„ä»¶</span>
<span class="token keyword">from</span> langchain_community<span class="token punctuation">.</span>document_loaders <span class="token keyword">import</span> DirectoryLoader
<span class="token keyword">from</span> langchain_text_splitters <span class="token keyword">import</span> RecursiveCharacterTextSplitter
<span class="token keyword">from</span> langchain_chroma <span class="token keyword">import</span> Chroma

<span class="token comment"># æ ¸å¿ƒæµç¨‹</span>
<span class="token number">1.</span> åŠ è½½æ–‡æ¡£
loader <span class="token operator">=</span> DirectoryLoader<span class="token punctuation">(</span>data_path<span class="token punctuation">,</span> glob<span class="token operator">=</span><span class="token string">&quot;*.txt&quot;</span><span class="token punctuation">)</span>
<span class="token number">2.</span> æ–‡æœ¬åˆ†å‰²
text_splitter <span class="token operator">=</span> RecursiveCharacterTextSplitter<span class="token punctuation">(</span>
    chunk_size<span class="token operator">=</span>chunk_size<span class="token punctuation">,</span>
    chunk_overlap<span class="token operator">=</span><span class="token number">200</span>
<span class="token punctuation">)</span>
<span class="token number">3.</span> åˆ›å»ºå‘é‡æ•°æ®åº“
vectordb <span class="token operator">=</span> Chroma<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>
    documents<span class="token operator">=</span>split_docs<span class="token punctuation">,</span>
    embedding<span class="token operator">=</span>embedding_func<span class="token punctuation">,</span>
    persist_directory<span class="token operator">=</span>persist_directory<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>python run/demo_rag_langchain_onlinellm.py
</code></pre></div><p><img src="/assets/img/2025-07-09-12-25-04.93eba88d.png" alt="snapshot"></p> <h2 id="rag-langchain-ä¸ªäººçŸ¥è¯†åº“åŠ©æ‰‹"><a href="#rag-langchain-ä¸ªäººçŸ¥è¯†åº“åŠ©æ‰‹" class="header-anchor">#</a> RAG-LangChain ä¸ªäººçŸ¥è¯†åº“åŠ©æ‰‹</h2> <p>TODO</p> <h2 id="rag-llamaindex-ç®€å•ç‰ˆæœ¬"><a href="#rag-llamaindex-ç®€å•ç‰ˆæœ¬" class="header-anchor">#</a> RAG-LlamaIndex ç®€å•ç‰ˆæœ¬</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># åŸºæœ¬ç»„ä»¶</span>
<span class="token keyword">from</span> llama_index<span class="token punctuation">.</span>core <span class="token keyword">import</span> SimpleDirectoryReader<span class="token punctuation">,</span> VectorStoreIndex
<span class="token keyword">from</span> llama_index<span class="token punctuation">.</span>vector_stores<span class="token punctuation">.</span>faiss <span class="token keyword">import</span> FaissVectorStore

<span class="token comment"># æ ¸å¿ƒæµç¨‹</span>
<span class="token number">1.</span> åŠ è½½æ–‡æ¡£
documents <span class="token operator">=</span> SimpleDirectoryReader<span class="token punctuation">(</span>data_dir<span class="token punctuation">)</span><span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token number">2.</span> åˆ›å»ºç´¢å¼•
index <span class="token operator">=</span> VectorStoreIndex<span class="token punctuation">.</span>from_documents<span class="token punctuation">(</span>
    documents<span class="token punctuation">,</span>
    storage_context<span class="token operator">=</span>storage_context
<span class="token punctuation">)</span>

<span class="token number">3.</span> åˆ›å»ºæ£€ç´¢å™¨
retriever <span class="token operator">=</span> VectorIndexRetriever<span class="token punctuation">(</span>index<span class="token operator">=</span>index<span class="token punctuation">)</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>python test/knowledges/llamaindex/test_RAG_zhipuai_simple.py
</code></pre></div><p><img src="/assets/img/2025-07-09-21-26-21.4a33cfef.png" alt="snapshot"></p> <h2 id="rag-llamaindex-é«˜çº§ç‰ˆæœ¬"><a href="#rag-llamaindex-é«˜çº§ç‰ˆæœ¬" class="header-anchor">#</a> RAG-LlamaIndex é«˜çº§ç‰ˆæœ¬</h2> <p>TODO</p> <h2 id="tavily-web-search"><a href="#tavily-web-search" class="header-anchor">#</a> Tavily - Web Search</h2> <p><strong>èŒè´£ï¼š</strong> æµ‹è¯•tavilyçš„webæœç´¢åŠŸèƒ½</p> <div class="language-python extra-class"><pre class="language-python"><code>tavily_client <span class="token operator">=</span> TavilyClient<span class="token punctuation">(</span>api_key<span class="token operator">=</span>os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">&quot;TAVILY_API_KEY&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
response <span class="token operator">=</span> tavily_client<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">&quot;What is the weather in Shanghai?&quot;</span><span class="token punctuation">,</span>max_results<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> url <span class="token keyword">in</span> response<span class="token punctuation">[</span><span class="token string">'results'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Rund Demo</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>python test/agents/metagpt/test_WebSearch.py    
</code></pre></div><p><img src="/assets/img/2025-07-09-23-07-28.23823644.png" alt="snapshot"></p> <h2 id="metagpt-æ™ºèƒ½ä½“ä¹‹ç®€å•åŠ å‡"><a href="#metagpt-æ™ºèƒ½ä½“ä¹‹ç®€å•åŠ å‡" class="header-anchor">#</a> Metagpt - æ™ºèƒ½ä½“ä¹‹ç®€å•åŠ å‡</h2> <p><strong>èŒè´£ï¼š</strong> ä¸€ä¸ªè¶…çº§ç®€å•çš„åŠ å‡åŠŸèƒ½</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">SimpleCalculator</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;ä¸€ä¸ªç®€å•çš„è®¡ç®—Action&quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;SimpleCalculator&quot;</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instruction<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># è§£æè¾“å…¥</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;å½“å‰run ï¼š </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">(</span>instruction<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>instruction<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            num1<span class="token punctuation">,</span> num2 <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> instruction<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>num1<span class="token punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">{</span>num2<span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span>num1 <span class="token operator">+</span> num2<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;è®¡ç®—ç»“æœ: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> result
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            error_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;è®¡ç®—é”™è¯¯: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
            logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span>
            <span class="token keyword">return</span> error_msg

<span class="token keyword">class</span> <span class="token class-name">CalculatorAssistant</span><span class="token punctuation">(</span>Role<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;è®¡ç®—åŠ©æ‰‹è§’è‰²

    ReAct å¾ªç¯çš„æ¨¡å¼ï¼Œç›®å‰æ”¯æŒ REACTã€BY_ORDERã€PLAN_AND_ACT 3ç§æ¨¡å¼ï¼Œ
    é»˜è®¤ä½¿ç”¨ REACT æ¨¡å¼ã€‚åœ¨ _set_react_mode æ–¹æ³•ä¸­æœ‰ç›¸å…³è¯´æ˜ã€‚ç®€å•æ¥è¯´ï¼ŒBY_ORDER æ¨¡å¼æŒ‰ç…§æŒ‡å®šçš„ Action é¡ºåºæ‰§è¡Œã€‚
    PLAN_AND_ACT åˆ™ä¸ºä¸€æ¬¡æ€è€ƒåæ‰§è¡Œå¤šä¸ªåŠ¨ä½œï¼Œå³ _think -&gt; _act -&gt; act -&gt; ...ï¼Œ
    è€Œ REACT æ¨¡å¼æŒ‰ç…§ ReAct è®ºæ–‡ä¸­çš„æ€è€ƒâ€”â€”è¡ŒåŠ¨å¾ªç¯æ¥æ‰§è¡Œï¼Œå³ _think -&gt; _act -&gt; _think -&gt; _act -&gt; ...ã€‚
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;Calculator&quot;</span>
    profile<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;ä¸€ä¸ªç®€å•çš„è®¡ç®—åŠ©æ‰‹ï¼Œè´Ÿè´£è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ&quot;</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>set_actions<span class="token punctuation">(</span><span class="token punctuation">[</span>SimpleCalculator<span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_set_react_mode<span class="token punctuation">(</span>react_mode<span class="token operator">=</span>RoleReactMode<span class="token punctuation">.</span>BY_ORDER<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">_act</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Message<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>_setting<span class="token punctuation">}</span></span><span class="token string">: to do </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>rc<span class="token punctuation">.</span>todo<span class="token punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>rc<span class="token punctuation">.</span>todo<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span>
        todo <span class="token operator">=</span> self<span class="token punctuation">.</span>rc<span class="token punctuation">.</span>todo
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;å½“å‰_act ï¼š </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">type</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>rc<span class="token punctuation">.</span>todo<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>rc<span class="token punctuation">.</span>todo<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

        msg <span class="token operator">=</span> self<span class="token punctuation">.</span>get_memories<span class="token punctuation">(</span>k<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># è·å–æœ€è¿‘çš„æ¶ˆæ¯</span>
        result <span class="token operator">=</span> <span class="token keyword">await</span> todo<span class="token punctuation">.</span>run<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
        
        msg <span class="token operator">=</span> Message<span class="token punctuation">(</span>content<span class="token operator">=</span>result<span class="token punctuation">,</span> role<span class="token operator">=</span>self<span class="token punctuation">.</span>profile<span class="token punctuation">,</span> cause_by<span class="token operator">=</span><span class="token builtin">type</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> msg

<span class="token keyword">def</span> <span class="token function">run_example</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;è¿è¡Œå•ä¸ªè®¡ç®—ç¤ºä¾‹&quot;&quot;&quot;</span>
    role <span class="token operator">=</span> CalculatorAssistant<span class="token punctuation">(</span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;è¾“å…¥: </span><span class="token interpolation"><span class="token punctuation">{</span>msg<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>role<span class="token punctuation">.</span>run<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;ç»“æœ: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;è¿è¡Œå¤šä¸ªè®¡ç®—ç¤ºä¾‹&quot;&quot;&quot;</span>
    <span class="token comment"># åŸºæœ¬åŠ æ³•ç¤ºä¾‹</span>
    run_example<span class="token punctuation">(</span><span class="token string">&quot;5 + 3&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># å¤§æ•°åŠ æ³•ç¤ºä¾‹</span>
    run_example<span class="token punctuation">(</span><span class="token string">&quot;1234 + 5678&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># è´Ÿæ•°åŠ æ³•ç¤ºä¾‹</span>
    run_example<span class="token punctuation">(</span><span class="token string">&quot;-10 + 5&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># é”™è¯¯è¾“å…¥ç¤ºä¾‹</span>
    run_example<span class="token punctuation">(</span><span class="token string">&quot;abc + def&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># é›¶çš„åŠ æ³•ç¤ºä¾‹</span>
    run_example<span class="token punctuation">(</span><span class="token string">&quot;0 + 100&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    fire<span class="token punctuation">.</span>Fire<span class="token punctuation">(</span>main<span class="token punctuation">)</span>
</code></pre></div><p><strong>Rund Demo</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>python test/agents/metagpt/test_metagpt_dummy.py 
</code></pre></div><p><img src="/assets/img/2025-07-09-23-03-28.d87ef7b2.png" alt="snapshot"></p> <h2 id="metagpt-æ™ºèƒ½ä½“ä¹‹æ„å›¾è¯†åˆ«"><a href="#metagpt-æ™ºèƒ½ä½“ä¹‹æ„å›¾è¯†åˆ«" class="header-anchor">#</a> Metagpt - æ™ºèƒ½ä½“ä¹‹æ„å›¾è¯†åˆ«</h2> <p><strong>èŒè´£</strong>ï¼šåˆ†æç”¨æˆ·è¾“å…¥ï¼Œè¯†åˆ«ç”¨æˆ·æ„å›¾å¹¶æ˜ å°„åˆ°é¢„å®šä¹‰åœºæ™¯</p> <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p> <ul><li>åˆ†æç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€æ–‡æœ¬</li> <li>è¯†åˆ«ç”¨æˆ·å½“å‰çš„æ„å›¾å’Œéœ€æ±‚</li> <li>å°†ç”¨æˆ·é—®é¢˜åŒ¹é…åˆ°é¢„å®šä¹‰çš„åœºæ™¯ç±»å‹</li> <li>è¾“å‡ºåœºæ™¯æ ‡ç­¾ä¾›åç»­å¤„ç†</li></ul> <p><strong>å¯ç”¨Actions</strong>ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code>  <span class="token keyword">class</span> <span class="token class-name">IntentAnalyze</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token triple-quoted-string string">&quot;&quot;&quot;åˆ†æç”¨æˆ·æ„å›¾å¹¶æ˜ å°„åˆ°é¢„å®šä¹‰åœºæ™¯æ ‡ç­¾
      ä½¿ç”¨LLMåˆ†æç”¨æˆ·è¾“å…¥ï¼Œè¿”å›å¯¹åº”çš„åœºæ™¯ç±»å‹ç¼–å·
      &quot;&quot;&quot;</span>
      name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;IntentAnalyze&quot;</span>
</code></pre></div><p><strong>Run demo:</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>streamlit run test/agents/metagpt_agents/intentRecognition/role.py
</code></pre></div><p><img src="/assets/img/2025-07-09-21-59-33.b762efe7.png" alt="snapshot"></p> <h2 id="metagpt-æ™ºèƒ½ä½“ä¹‹åœºæ™¯ç»†åŒ–"><a href="#metagpt-æ™ºèƒ½ä½“ä¹‹åœºæ™¯ç»†åŒ–" class="header-anchor">#</a> Metagpt - æ™ºèƒ½ä½“ä¹‹åœºæ™¯ç»†åŒ–</h2> <p><strong>èŒè´£</strong>ï¼šæå–å’Œå®Œå–„åœºæ™¯è¦ç´ </p> <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p> <ul><li>ä¿¡æ¯æŠ½å–ï¼šä»ç”¨æˆ·å¯¹è¯ä¸­æå–åœºæ™¯è¦ç´ </li> <li>æé—®åŠ©æ‰‹ï¼šå¯¹ç¼ºå¤±çš„åœºæ™¯è¦ç´ è¿›è¡Œæé—®</li> <li>åœºæ™¯è¦ç´ éªŒè¯ï¼šç¡®ä¿æ‰€æœ‰å¿…è¦ä¿¡æ¯å®Œæ•´</li></ul> <p><strong>å¯ç”¨Actions</strong>ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code> <span class="token keyword">class</span> <span class="token class-name">sceneRefineAnalyze</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token triple-quoted-string string">&quot;&quot;&quot;æå–åœºæ™¯è¦ç´ 
      ä»ç”¨æˆ·è¾“å…¥ä¸­æå–ç‰¹å®šåœºæ™¯æ‰€éœ€çš„å…³é”®ä¿¡æ¯
      &quot;&quot;&quot;</span>
      name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;sceneRefineAnalyze&quot;</span>

  <span class="token keyword">class</span> <span class="token class-name">RaiseQuestion</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token triple-quoted-string string">&quot;&quot;&quot;ç”Ÿæˆè¡¥å……é—®é¢˜
      é’ˆå¯¹ç¼ºå¤±çš„åœºæ™¯è¦ç´ ç”Ÿæˆè‡ªç„¶çš„è¿½é—®
      &quot;&quot;&quot;</span>
      name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;RaiseQuestion&quot;</span>
</code></pre></div><p><strong>Run demo:</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code> streamlit run test/agents/metagpt/sceneRefine_test_case.py 
</code></pre></div><p><img src="/assets/img/2025-07-09-22-12-46.67acff32.png" alt="snapshot"></p> <h2 id="metagpt-æ™ºèƒ½ä½“ä¹‹å›ç­”åŠ©æ‰‹"><a href="#metagpt-æ™ºèƒ½ä½“ä¹‹å›ç­”åŠ©æ‰‹" class="header-anchor">#</a> Metagpt - æ™ºèƒ½ä½“ä¹‹å›ç­”åŠ©æ‰‹</h2> <p><strong>èŒè´£</strong>ï¼šåŸºäºåœºæ™¯è¦ç´ ç”Ÿæˆå®šåˆ¶åŒ–å›ç­”</p> <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p> <ul><li>æ•´åˆåœºæ™¯ä¿¡æ¯å’Œç”¨æˆ·éœ€æ±‚</li> <li>ç”Ÿæˆé’ˆå¯¹æ€§çš„å»ºè®®å’Œè§£ç­”</li> <li>æä¾›è¯¦ç»†çš„ç¤ºä¾‹å’Œè¯´æ˜</li></ul> <p><strong>å¯ç”¨Actions</strong>ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">AnswerQuestion</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;ç”Ÿæˆå®šåˆ¶åŒ–å›ç­”
    åŸºäºå®Œæ•´çš„åœºæ™¯è¦ç´ ï¼Œç”Ÿæˆç¬¦åˆç”¨æˆ·éœ€æ±‚çš„è¯¦ç»†å›ç­”
    ä½¿ç”¨æ¨¡æ¿ç³»ç»Ÿç¡®ä¿å›ç­”çš„ç»“æ„æ€§å’Œå®Œæ•´æ€§
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;AnswerQuestion&quot;</span>
</code></pre></div><p><strong>Run demo:</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code> streamlit run test/agents/metagpt/answerBot_test_case.py 
</code></pre></div><p><img src="/assets/img/2025-07-09-22-17-20.4c700044.png" alt="snapshot"></p> <h2 id="metagpt-æ™ºèƒ½ä½“ä¹‹æœç´¢åŠ©æ‰‹"><a href="#metagpt-æ™ºèƒ½ä½“ä¹‹æœç´¢åŠ©æ‰‹" class="header-anchor">#</a> Metagpt - æ™ºèƒ½ä½“ä¹‹æœç´¢åŠ©æ‰‹</h2> <p><strong>èŒè´£</strong>ï¼šé€šè¿‡ç½‘ç»œæœç´¢è¡¥å……å›ç­”å†…å®¹</p> <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p> <ul><li>æŸ¥è¯¢æ‰©å±•ï¼šç”Ÿæˆç›¸å…³æœç´¢æŸ¥è¯¢</li> <li>ç½‘ç»œæœç´¢ï¼šä½¿ç”¨æœç´¢å¼•æ“è·å–ç›¸å…³ä¿¡æ¯</li> <li>ç»“æœç­›é€‰ï¼šåˆ¤æ–­å’Œç­›é€‰æœ‰ä»·å€¼çš„ç½‘é¡µå†…å®¹</li> <li>å†…å®¹æå–ï¼šæŠ“å–å’Œè¿‡æ»¤ç½‘é¡µå†…å®¹</li> <li>ç»“æœæ•´åˆï¼šå°†æœç´¢ç»“æœæ•´åˆåˆ°å›ç­”ä¸­</li></ul> <p><strong>å¯ç”¨Actions</strong>ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">QueryExpansion</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;ç”Ÿæˆæ‰©å±•æŸ¥è¯¢
    åŸºäºç”¨æˆ·è¾“å…¥ç”Ÿæˆå¤šä¸ªç›¸å…³çš„æœç´¢æŸ¥è¯¢
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;queryExpansion&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">WebSearch</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;æ‰§è¡Œç½‘ç»œæœç´¢
    ä½¿ç”¨æœç´¢å¼•æ“è·å–ç›¸å…³ç½‘é¡µå†…å®¹
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;WebSearch&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">SelectResult</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;ç­›é€‰æœç´¢ç»“æœ
    åˆ¤æ–­å“ªäº›æœç´¢ç»“æœå€¼å¾—è¿›ä¸€æ­¥åˆ†æ
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;selectResult&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">SelectFetcher</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;æŠ“å–ç½‘é¡µå†…å®¹
    è·å–ç­›é€‰åçš„ç½‘é¡µçš„å…·ä½“å†…å®¹
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;selectFetcher&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">FilterSelectedResult</span><span class="token punctuation">(</span>Action<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;è¿‡æ»¤å’Œæå–ä¿¡æ¯
    ä»ç½‘é¡µå†…å®¹ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯
    &quot;&quot;&quot;</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;FilterSelectedResult&quot;</span>
</code></pre></div><p><strong>Run demo:</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code> streamlit run test/agents/metagpt/searcher_test_case.py 
</code></pre></div><video src="/Screen Recording 2025-07-09 at 22.32.04.mov" controls="controls" width="100%">
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
</video> <h2 id="xtuner-finetuningæ¨¡å‹"><a href="#xtuner-finetuningæ¨¡å‹" class="header-anchor">#</a> XTuner FineTuningæ¨¡å‹</h2> <p><strong>XTuner</strong> æ˜¯ä¸€ä¸ªåŸºäº LLM çš„æ¨¡å‹å¾®è°ƒå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿã€è½»æ¾åœ°å¾®è°ƒ LLM æ¨¡å‹ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ€§èƒ½å’Œæ•ˆæœã€‚Xtuner é›†æˆäº† LoRA å’Œ QLoRA ç­‰å¾®è°ƒæ–¹æ³•ï¼Œè®©ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªèº«èµ„æºæƒ…å†µçµæ´»é€‰æ‹©ï¼›è€Œ QLoRA æ˜¯ LoRA åœ¨é‡åŒ–åœºæ™¯ä¸‹çš„ä¼˜åŒ–æ‰©å±•ã€‚</p> <p><strong>å¹³å°</strong>ï¼šUbuntu + Anaconda + CUDA/CUDNN + 8GB nvidiaæ˜¾å¡</p> <p><strong>å®‰è£…</strong>ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># åœ¨ InternStudio å¹³å°ï¼Œåˆ™ä»æœ¬åœ° clone ä¸€ä¸ªå·²æœ‰ pytorch 2.0.1 çš„ç¯å¢ƒï¼š</span>
/root/share/install_conda_env_internlm_base.sh xtuner0.1.9

<span class="token comment"># è¿›å…¥homoe ç›®å½•</span>
<span class="token builtin class-name">cd</span> ~
<span class="token comment"># åˆ›å»ºç‰ˆæœ¬æ–‡ä»¶å¤¹å¹¶è¿›å…¥ï¼Œä»¥è·Ÿéšæœ¬æ•™ç¨‹</span>
<span class="token function">mkdir</span> xtuner019 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> xtuner019

<span class="token comment"># æ‹‰å– 0.1.9 çš„ç‰ˆæœ¬æºç </span>
<span class="token function">git</span> clone <span class="token parameter variable">-b</span> v0.1.9  https://github.com/InternLM/xtuner
<span class="token comment"># æ— æ³•è®¿é—®githubçš„ç”¨æˆ·è¯·ä» gitee æ‹‰å–:</span>
<span class="token comment"># git clone -b v0.1.9 https://gitee.com/Internlm/xtuner</span>

<span class="token comment"># è¿›å…¥æºç ç›®å½•</span>
<span class="token builtin class-name">cd</span> xtuner

<span class="token comment"># ä»æºç å®‰è£… XTuner</span>
pip <span class="token function">install</span> <span class="token parameter variable">-e</span> <span class="token string">'.[all]'</span>
</code></pre></div><p>å®‰è£…å®Œåï¼Œå°±å¼€å§‹ææå‡†å¤‡å·¥ä½œäº†ã€‚ï¼ˆå‡†å¤‡åœ¨ oasst1 æ•°æ®é›†ä¸Šå¾®è°ƒ internlm-7b-chatï¼‰</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºä¸€ä¸ªå¾®è°ƒ oasst1 æ•°æ®é›†çš„å·¥ä½œè·¯å¾„ï¼Œè¿›å…¥</span>
<span class="token function">mkdir</span> ~/ft-oasst1 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> ~/ft-oasst1
</code></pre></div><p><strong>å¾®è°ƒï¼š</strong>
XTuner æä¾›å¤šä¸ªå¼€ç®±å³ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹ï¼š</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token comment"># åˆ—å‡ºæ‰€æœ‰å†…ç½®é…ç½®</span>
xtuner list-cfg
</code></pre></div><blockquote><p>å‡å¦‚æ˜¾ç¤ºbash: xtuner: command not foundçš„è¯å¯ä»¥è€ƒè™‘åœ¨ç»ˆç«¯è¾“å…¥ export PATH=$PATH:'/root/.local/bin'</p></blockquote> <p><img src="/assets/img/2025-07-10-10-14-54.e80006cd.png" alt="snapshot"></p> <p>æ‹·è´ä¸€ä¸ªé…ç½®æ–‡ä»¶åˆ°å½“å‰ç›®å½•ï¼š
<code># xtuner copy-cfg ${CONFIG_NAME} ${SAVE_PATH}</code></p> <p>åœ¨æœ¬æ¡ˆä¾‹ä¸­å³ï¼šï¼ˆæ³¨æ„æœ€åæœ‰ä¸ªè‹±æ–‡å¥å·ï¼Œä»£è¡¨å¤åˆ¶åˆ°å½“å‰è·¯å¾„ï¼‰</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/ft-oasst1
xtuner copy-cfg internlm_chat_7b_qlora_oasst1_e3 <span class="token builtin class-name">.</span>
</code></pre></div><p>é…ç½®æ–‡ä»¶åçš„è§£é‡Šï¼š</p> <blockquote><p>xtuner copy-cfg internlm_chat_7b_qlora_oasst1_e3 .</p></blockquote> <table><thead><tr><th>æ¨¡å‹å</th> <th>internlm_chat_7b</th></tr></thead> <tbody><tr><td>ä½¿ç”¨ç®—æ³•</td> <td>qlora</td></tr> <tr><td>æ•°æ®é›†</td> <td>oasst1</td></tr> <tr><td>æŠŠæ•°æ®é›†è·‘å‡ æ¬¡</td> <td>è·‘3æ¬¡ï¼še3 (epoch 3 )</td></tr></tbody></table> <p>*æ—  chatæ¯”å¦‚ <code>internlm-7b</code> ä»£è¡¨æ˜¯åŸºåº§(base)æ¨¡å‹</p> <p><strong>æ¨¡å‹ä¸‹è½½ï¼š</strong></p> <blockquote><p>ç”±äºä¸‹è½½æ¨¡å‹å¾ˆæ…¢ï¼Œç”¨æ•™å­¦å¹³å°çš„åŒå­¦å¯ä»¥ç›´æ¥å¤åˆ¶æ¨¡å‹ã€‚</p></blockquote> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-s</span> /share/temp/model_repos/internlm-chat-7b ~/ft-oasst1/
</code></pre></div><p>ä»¥ä¸Šæ˜¯é€šè¿‡è½¯é“¾çš„æ–¹å¼ï¼Œå°†æ¨¡å‹æ–‡ä»¶æŒ‚è½½åˆ°å®¶ç›®å½•ä¸‹ï¼Œä¼˜åŠ¿æ˜¯ï¼š</p> <ol><li>èŠ‚çœæ‹·è´æ—¶é—´ï¼Œæ— éœ€ç­‰å¾…</li> <li>èŠ‚çœç”¨æˆ·å¼€å‘æœºå­˜å‚¨ç©ºé—´</li></ol> <blockquote><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨ <code>cp -r /share/temp/model_repos/internlm-chat-7b ~/ft-oasst1/</code> è¿›è¡Œæ•°æ®æ‹·è´ã€‚</p></blockquote> <blockquote><p>ä»¥ä¸‹æ˜¯è‡ªå·±ä¸‹è½½æ¨¡å‹çš„æ­¥éª¤ã€‚</p></blockquote> <p>ä¸ç”¨ xtuner é»˜è®¤çš„<code>ä» huggingface æ‹‰å–æ¨¡å‹</code>ï¼Œè€Œæ˜¯æå‰ä» <s>OpenXLab</s> ModelScope ä¸‹è½½æ¨¡å‹åˆ°æœ¬åœ°</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæ”¾æ¨¡å‹æ–‡ä»¶ï¼Œé˜²æ­¢æ•£è½ä¸€åœ°</span>
<span class="token function">mkdir</span> ~/ft-oasst1/internlm-chat-7b

<span class="token comment"># è£…ä¸€ä¸‹æ‹‰å–æ¨¡å‹æ–‡ä»¶è¦ç”¨çš„åº“</span>
pip <span class="token function">install</span> modelscope

<span class="token comment"># ä» modelscope ä¸‹è½½ä¸‹è½½æ¨¡å‹æ–‡ä»¶</span>
<span class="token builtin class-name">cd</span> ~/ft-oasst1
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">git</span> git-lfs <span class="token parameter variable">-y</span>
<span class="token function">git</span> lfs <span class="token function">install</span>
<span class="token function">git</span> lfs clone https://modelscope.cn/Shanghai_AI_Laboratory/internlm-chat-7b.git <span class="token parameter variable">-b</span> v1.0.3
</code></pre></div><p><strong>æ•°æ®é›†ä¸‹è½½ï¼š</strong></p> <blockquote><p>https://huggingface.co/datasets/timdettmers/openassistant-guanaco/tree/main</p></blockquote> <p>ç”±äº huggingface ç½‘ç»œé—®é¢˜ï¼Œå’±ä»¬å·²ç»ç»™å¤§å®¶æå‰ä¸‹è½½å¥½äº†ï¼Œå¤åˆ¶åˆ°æ­£ç¡®ä½ç½®å³å¯ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/ft-oasst1
<span class="token comment"># ...-guanaco åé¢æœ‰ä¸ªç©ºæ ¼å’Œè‹±æ–‡å¥å·å•Š</span>
<span class="token function">cp</span> <span class="token parameter variable">-r</span> /root/share/temp/datasets/openassistant-guanaco <span class="token builtin class-name">.</span>
</code></pre></div><p>æ­¤æ—¶ï¼Œå½“å‰è·¯å¾„çš„æ–‡ä»¶åº”è¯¥é•¿è¿™æ ·ï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">|</span>-- internlm-chat-7b
<span class="token operator">|</span>   <span class="token operator">|</span>-- README.md
<span class="token operator">|</span>   <span class="token operator">|</span>-- config.json
<span class="token operator">|</span>   <span class="token operator">|</span>-- configuration.json
<span class="token operator">|</span>   <span class="token operator">|</span>-- configuration_internlm.py
<span class="token operator">|</span>   <span class="token operator">|</span>-- generation_config.json
<span class="token operator">|</span>   <span class="token operator">|</span>-- modeling_internlm.py
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00001-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00002-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00003-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00004-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00005-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00006-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00007-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model-00008-of-00008.bin
<span class="token operator">|</span>   <span class="token operator">|</span>-- pytorch_model.bin.index.json
<span class="token operator">|</span>   <span class="token operator">|</span>-- special_tokens_map.json
<span class="token operator">|</span>   <span class="token operator">|</span>-- tokenization_internlm.py
<span class="token operator">|</span>   <span class="token operator">|</span>-- tokenizer.model
<span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-- tokenizer_config.json
<span class="token operator">|</span>-- internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="token variable">`</span></span>-- openassistant-guanaco
    <span class="token operator">|</span>-- openassistant_best_replies_eval.jsonl
    `-- openassistant_best_replies_train.jsonl
</code></pre></div><p><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</strong></p> <p>ä¿®æ”¹å…¶ä¸­çš„æ¨¡å‹å’Œæ•°æ®é›†ä¸º æœ¬åœ°è·¯å¾„</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> ~/ft-oasst1
<span class="token function">vim</span> internlm_chat_7b_qlora_oasst1_e3_copy.py
</code></pre></div><blockquote><p>åœ¨vimç•Œé¢å®Œæˆä¿®æ”¹åï¼Œè¯·è¾“å…¥:wqé€€å‡ºã€‚å‡å¦‚è®¤ä¸ºæ”¹é”™äº†å¯ä»¥ç”¨:q!é€€å‡ºä¸”ä¸ä¿å­˜ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘æ‰“å¼€pythonæ–‡ä»¶ç›´æ¥ä¿®æ”¹ï¼Œä½†æ³¨æ„ä¿®æ”¹å®Œåéœ€è¦æŒ‰ä¸‹Ctrl+Sè¿›è¡Œä¿å­˜ã€‚</p></blockquote> <p>å‡å·ä»£è¡¨è¦åˆ é™¤çš„è¡Œï¼ŒåŠ å·ä»£è¡¨è¦å¢åŠ çš„è¡Œã€‚</p> <div class="language-diff extra-class"><pre class="language-diff"><code># ä¿®æ”¹æ¨¡å‹ä¸ºæœ¬åœ°è·¯å¾„
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> pretrained_model_name_or_path = 'internlm/internlm-chat-7b'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> pretrained_model_name_or_path = './internlm-chat-7b'
</span></span>
# ä¿®æ”¹è®­ç»ƒæ•°æ®é›†ä¸ºæœ¬åœ°è·¯å¾„
<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> data_path = 'timdettmers/openassistant-guanaco'
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> data_path = './openassistant-guanaco'
</span></span></code></pre></div><p><strong>å¸¸ç”¨è¶…å‚</strong></p> <table><thead><tr><th>å‚æ•°å</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><strong>data_path</strong></td> <td>æ•°æ®è·¯å¾„æˆ– HuggingFace ä»“åº“å</td></tr> <tr><td>max_length</td> <td>å•æ¡æ•°æ®æœ€å¤§ Token æ•°ï¼Œè¶…è¿‡åˆ™æˆªæ–­</td></tr> <tr><td>pack_to_max_length</td> <td>æ˜¯å¦å°†å¤šæ¡çŸ­æ•°æ®æ‹¼æ¥åˆ° max_lengthï¼Œæé«˜ GPU åˆ©ç”¨ç‡</td></tr> <tr><td>accumulative_counts</td> <td>æ¢¯åº¦ç´¯ç§¯ï¼Œæ¯å¤šå°‘æ¬¡ backward æ›´æ–°ä¸€æ¬¡å‚æ•°</td></tr> <tr><td>evaluation_inputs</td> <td>è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¼šæ ¹æ®ç»™å®šçš„é—®é¢˜è¿›è¡Œæ¨ç†ï¼Œä¾¿äºè§‚æµ‹è®­ç»ƒçŠ¶æ€</td></tr> <tr><td>evaluation_freq</td> <td>Evaluation çš„è¯„æµ‹é—´éš” iter æ•°</td></tr> <tr><td>......</td> <td>......</td></tr></tbody></table> <blockquote><p>å¦‚æœæƒ³æŠŠæ˜¾å¡çš„ç°å­˜åƒæ»¡ï¼Œå……åˆ†åˆ©ç”¨æ˜¾å¡èµ„æºï¼Œå¯ä»¥å°† <code>max_length</code> å’Œ <code>batch_size</code> è¿™ä¸¤ä¸ªå‚æ•°è°ƒå¤§ã€‚</p></blockquote> <p>å¼€å§‹å¾®è°ƒ</p> <p><strong>è®­ç»ƒï¼š</strong></p> <p>xtuner train ${CONFIG_NAME_OR_PATH}</p> <p><strong>ä¹Ÿå¯ä»¥å¢åŠ  deepspeed è¿›è¡Œè®­ç»ƒåŠ é€Ÿï¼š</strong></p> <p>xtuner train ${CONFIG_NAME_OR_PATH} --deepspeed deepspeed_zero2</p> <p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ QLoRA ç®—æ³•åœ¨ oasst1 æ•°æ®é›†ä¸Šå¾®è°ƒ InternLM-7Bï¼š</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token comment"># å•å¡</span>
<span class="token comment">## ç”¨åˆšæ‰æ”¹å¥½çš„configæ–‡ä»¶è®­ç»ƒ</span>
xtuner train ./internlm_chat_7b_qlora_oasst1_e3_copy.py

<span class="token comment"># å¤šå¡</span>
<span class="token assign-left variable">NPROC_PER_NODE</span><span class="token operator">=</span><span class="token variable">${GPU_NUM}</span> xtuner train ./internlm_chat_7b_qlora_oasst1_e3_copy.py

<span class="token comment"># è‹¥è¦å¼€å¯ deepspeed åŠ é€Ÿï¼Œå¢åŠ  --deepspeed deepspeed_zero2 å³å¯</span>
</code></pre></div><blockquote><p>å¾®è°ƒå¾—åˆ°çš„ PTH æ¨¡å‹æ–‡ä»¶å’Œå…¶ä»–æ‚ä¸ƒæ‚å…«çš„æ–‡ä»¶éƒ½é»˜è®¤åœ¨å½“å‰çš„ <code>./work_dirs</code> ä¸­ã€‚</p></blockquote> <p>è·‘å®Œè®­ç»ƒåï¼Œå½“å‰è·¯å¾„åº”è¯¥é•¿è¿™æ ·ï¼š</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token operator">|</span>-- internlm-chat-7b
<span class="token operator">|</span>-- internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="token operator">|</span>-- openassistant-guanaco
<span class="token operator">|</span>   <span class="token operator">|</span>-- openassistant_best_replies_eval.jsonl
<span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-- openassistant_best_replies_train.jsonl
<span class="token variable">`</span></span>-- work_dirs
    <span class="token variable"><span class="token variable">`</span>-- internlm_chat_7b_qlora_oasst1_e3_copy
        <span class="token operator">|</span>-- 20231101_152923
        <span class="token operator">|</span>   <span class="token operator">|</span>-- 20231101_152923.log
        <span class="token operator">|</span>   <span class="token variable">`</span></span>-- vis_data
        <span class="token operator">|</span>       <span class="token operator">|</span>-- 20231101_152923.json
        <span class="token operator">|</span>       <span class="token operator">|</span>-- config.py
        <span class="token operator">|</span>       <span class="token variable"><span class="token variable">`</span>-- scalars.json
        <span class="token operator">|</span>-- epoch_1.pth
        <span class="token operator">|</span>-- epoch_2.pth
        <span class="token operator">|</span>-- epoch_3.pth
        <span class="token operator">|</span>-- internlm_chat_7b_qlora_oasst1_e3_copy.py
        <span class="token variable">`</span></span>-- last_checkpoint
</code></pre></div><p>å°†å¾—åˆ°çš„ PTH æ¨¡å‹è½¬æ¢ä¸º HuggingFace æ¨¡å‹ï¼Œ<strong>å³ï¼šç”Ÿæˆ Adapter æ–‡ä»¶å¤¹</strong></p> <p><code>xtuner convert pth_to_hf ${CONFIG_NAME_OR_PATH} ${PTH_file_dir} ${SAVE_PATH}</code></p> <p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œä¸ºï¼š</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> hf
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MKL_SERVICE_FORCE_INTEL</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">MKL_THREADING_LAYER</span><span class="token operator">=</span>GNU
xtuner convert pth_to_hf ./internlm_chat_7b_qlora_oasst1_e3_copy.py ./work_dirs/internlm_chat_7b_qlora_oasst1_e3_copy/epoch_1.pth ./hf
</code></pre></div><p>æ­¤æ—¶ï¼Œè·¯å¾„ä¸­åº”è¯¥é•¿è¿™æ ·ï¼š</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token operator">|</span>-- internlm-chat-7b
<span class="token operator">|</span>-- internlm_chat_7b_qlora_oasst1_e3_copy.py
<span class="token operator">|</span>-- openassistant-guanaco
<span class="token operator">|</span>   <span class="token operator">|</span>-- openassistant_best_replies_eval.jsonl
<span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-- openassistant_best_replies_train.jsonl
<span class="token operator">|</span>-- hf
<span class="token operator">|</span>   <span class="token operator">|</span>-- README.md
<span class="token operator">|</span>   <span class="token operator">|</span>-- adapter_config.json
<span class="token operator">|</span>   <span class="token operator">|</span>-- adapter_model.bin
<span class="token operator">|</span>   <span class="token variable">`</span></span>-- xtuner_config.py
<span class="token variable"><span class="token variable">`</span>-- work_dirs
    <span class="token variable">`</span></span>-- internlm_chat_7b_qlora_oasst1_e3_copy
        <span class="token operator">|</span>-- 20231101_152923
        <span class="token operator">|</span>   <span class="token operator">|</span>-- 20231101_152923.log
        <span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-- vis_data
        <span class="token operator">|</span>       <span class="token operator">|</span>-- 20231101_152923.json
        <span class="token operator">|</span>       <span class="token operator">|</span>-- config.py
        <span class="token operator">|</span>       <span class="token variable">`</span></span>-- scalars.json
        <span class="token operator">|</span>-- epoch_1.pth
        <span class="token operator">|</span>-- epoch_2.pth
        <span class="token operator">|</span>-- epoch_3.pth
        <span class="token operator">|</span>-- internlm_chat_7b_qlora_oasst1_e3_copy.py
        `-- last_checkpoint
</code></pre></div><p><span style="color:red;"><strong>æ­¤æ—¶ï¼Œhf æ–‡ä»¶å¤¹å³ä¸ºæˆ‘ä»¬å¹³æ—¶æ‰€ç†è§£çš„æ‰€è°“ â€œLoRA æ¨¡å‹æ–‡ä»¶â€</strong></span></p> <blockquote><p>å¯ä»¥ç®€å•ç†è§£ï¼šLoRA æ¨¡å‹æ–‡ä»¶ = Adapter</p></blockquote> <p><strong>éƒ¨ç½²ä¸æµ‹è¯•ï¼š</strong></p> <p>å°† HuggingFace adapter åˆå¹¶åˆ°å¤§è¯­è¨€æ¨¡å‹ï¼š</p> <div class="language-Bash extra-class"><pre class="language-bash"><code>xtuner convert merge ./internlm-chat-7b ./hf ./merged --max-shard-size 2GB
<span class="token comment"># xtuner convert merge \</span>
<span class="token comment">#     ${NAME_OR_PATH_TO_LLM} \</span>
<span class="token comment">#     ${NAME_OR_PATH_TO_ADAPTER} \</span>
<span class="token comment">#     ${SAVE_PATH} \</span>
<span class="token comment">#     --max-shard-size 2GB</span>
</code></pre></div><p>ä¸åˆå¹¶åçš„æ¨¡å‹å¯¹è¯ï¼š</p> <div class="language-Bash extra-class"><pre class="language-bash"><code><span class="token comment"># åŠ è½½ Adapter æ¨¡å‹å¯¹è¯ï¼ˆFloat 16ï¼‰</span>
xtuner chat ./merged --prompt-template internlm_chat

<span class="token comment"># 4 bit é‡åŒ–åŠ è½½</span>
<span class="token comment"># xtuner chat ./merged --bits 4 --prompt-template internlm_chat</span>
</code></pre></div><p>Demo</p> <ul><li>ä¿®æ”¹ <code>cli_demo.py</code> ä¸­çš„æ¨¡å‹è·¯å¾„</li></ul> <div class="language-diff extra-class"><pre class="language-diff"><code><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> model_name_or_path = &quot;/root/model/Shanghai_AI_Laboratory/internlm-chat-7b&quot;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> model_name_or_path = &quot;merged&quot;
</span></span></code></pre></div><ul><li>è¿è¡Œ <code>cli_demo.py</code> ä»¥ç›®æµ‹å¾®è°ƒæ•ˆæœ</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>python ./cli_demo.py
</code></pre></div><p><strong>æ•ˆæœï¼š</strong></p> <table><thead><tr><th>å¾®è°ƒå‰</th> <th>å¾®è°ƒå</th></tr></thead> <tbody><tr><td>TODO</td> <td>TODO</td></tr></tbody></table> <p><strong><code>xtuner chat</code></strong> <strong>çš„å¯åŠ¨å‚æ•°</strong></p> <table><thead><tr><th>å¯åŠ¨å‚æ•°</th> <th>å¹²å“ˆæ»´</th></tr></thead> <tbody><tr><td><strong>--prompt-template</strong></td> <td>æŒ‡å®šå¯¹è¯æ¨¡æ¿</td></tr> <tr><td>--system</td> <td>æŒ‡å®šSYSTEMæ–‡æœ¬</td></tr> <tr><td>--system-template</td> <td>æŒ‡å®šSYSTEMæ¨¡æ¿</td></tr> <tr><td>-<strong>-bits</strong></td> <td>LLMä½æ•°</td></tr> <tr><td>--bot-name</td> <td>botåç§°</td></tr> <tr><td>--with-plugins</td> <td>æŒ‡å®šè¦ä½¿ç”¨çš„æ’ä»¶</td></tr> <tr><td><strong>--no-streamer</strong></td> <td>æ˜¯å¦å¯ç”¨æµå¼ä¼ è¾“</td></tr> <tr><td><strong>--lagent</strong></td> <td>æ˜¯å¦ä½¿ç”¨lagent</td></tr> <tr><td>--command-stop-word</td> <td>å‘½ä»¤åœæ­¢è¯</td></tr> <tr><td>--answer-stop-word</td> <td>å›ç­”åœæ­¢è¯</td></tr> <tr><td>--offload-folder</td> <td>å­˜æ”¾æ¨¡å‹æƒé‡çš„æ–‡ä»¶å¤¹ï¼ˆæˆ–è€…å·²ç»å¸è½½æ¨¡å‹æƒé‡çš„æ–‡ä»¶å¤¹ï¼‰</td></tr> <tr><td>--max-new-tokens</td> <td>ç”Ÿæˆæ–‡æœ¬ä¸­å…è®¸çš„æœ€å¤§ <code>token</code> æ•°é‡</td></tr> <tr><td><strong>--temperature</strong></td> <td>æ¸©åº¦å€¼</td></tr> <tr><td>--top-k</td> <td>ä¿ç•™ç”¨äºé¡¶kç­›é€‰çš„æœ€é«˜æ¦‚ç‡è¯æ±‡æ ‡è®°æ•°</td></tr> <tr><td>--top-p</td> <td>å¦‚æœè®¾ç½®ä¸ºå°äº1çš„æµ®ç‚¹æ•°ï¼Œä»…ä¿ç•™æ¦‚ç‡ç›¸åŠ é«˜äº <code>top_p</code> çš„æœ€å°ä¸€ç»„æœ€æœ‰å¯èƒ½çš„æ ‡è®°</td></tr> <tr><td>--seed</td> <td>ç”¨äºå¯é‡ç°æ–‡æœ¬ç”Ÿæˆçš„éšæœºç§å­</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/10/2025, 6:03:05 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/llm/llm_basic.html">
        LLM AI åŸºç¡€
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.43ae17cf.js" defer></script><script src="/assets/js/2.e9459d84.js" defer></script><script src="/assets/js/1.6a359339.js" defer></script><script src="/assets/js/13.85cf1ae9.js" defer></script>
  </body>
</html>
